<h1 id="project_title">Project list</h1>
<hr>
<form id="file_form" method="get" action="/projects" enctype="multipart/form-data">

<div class="tech">
<input type="text" placeholder="기술"  class="search">
</div>

<!--스킬 검색창 띄우는곳-->
<div class="add_skill"></div></br>

<!--스킬 뱃지달리는곳-->
<div class="skill_badge"></div></br>

<!--스킬 값 받는 곳-->
<div class="form-group">
<input type="hidden" name="project[skill]" id="skill">
</div>

<select class="category_list">
    <option value="select">카테고리</option>
    <option value="빅데이터">빅데이터</option>
    <option value="웹">웹</option>
    <option value="앱">앱</option>
    <option value="ai">ai</option>
</select>

<!-- 카테고리 달리는 곳  -->
<div class="add_categories"></div></br>

 <!--카테고리 값 받는곳 -->
<div class="form-group">
  
<input type="hidden" name="project[category]" id="category">
</div>

<input type="submit" value="검색하기">
</form> 

  

<hr>
<div id="project" class="row">
  <% @projects.each do |project| %>
  <div class="card col-md-3">
    <h3 class="card-title"><span>title: <%= project.project_title %></span></h3>
    <img class="card-img-top" src="<%= project.image_path.thumb.url %>" alt="<%= project.project_title%>">
    <div class="card-body"
      <p class="card-text">contents: <%= simple_format(project.project_contents) %></p>
      <p class="card-text">+<%= TimeDifference.between(DateTime.now, project.created_at).in_days.round(0) %>days</p>
      <p class="card-text"><%= project.unique_impression_count %>views</p>
      <p class="card-text">인원수 : <%= UserProject.select(:id).where(:project_id => project.id, :authorized_member => true).count %>/<%= project.project_people %></p>
      <p>관련스킬: <% project.skills.each do |skill| %>
                   <%= skill.skill_contents %>
                   <% end %></p>
      
      <%= link_to '상세보기 ', project_path(project), class: 'btn btn-primary' %>
    </div>
  </div>
    <% end %>
</div>



<br>

<h3><%= link_to '프로젝트 등록하기', new_project_path %></h3>

<script>
   
  $(document).ready(function(){
        var find_skill = [];
        var find_category = [];
        //스킬 탐색 기능
        
       
        $('.search').on('keyup', function(){
            
            var search = $(this).val();
            $.ajax({
                url:'/projects/search',
                type:'POST',
                data: {
                    tech: search
                }
                
            });
        });
        
         //스킬 뱃지 달기
        $(document).on('click', '.skill', function(){
           find_skill.push($(this).text());
           $(".skill_badge").prepend(`<span class='delete'>${$(this).text()}x#</span>`);
           $('#skill').val(find_skill.join(','));
           
        })
        
        //x를 눌렸을 때 스킬이 제거됨
        $(document).on('click','.delete',function(){
            var index =find_skill.indexOf($(this).text());
            find_skill.splice(index,1);
            $('#skill').val(find_skill.join(','));
            $(this).remove();
        })
        
           //카테고리 선택 뱃지 달기
        $(".category_list").on('change',function(){
            let selected_category = $(".category_list option:selected").text();
            let category_id = $(".category_list option:selected").val();
            find_category.push(category_id);
            $('#category').val(find_category.join(',')); //카테고리 값 넣는 곳
            $(".add_categories").prepend(`<span class='delete' data-category_id="${category_id}">${selected_category}x#</span>`)
        })
            //카테고리 선택 뱃지 제거
        $(document).on("click",".delete",function(){
            let selected_category= $(this).data('category_id');//number 타입이라 배열은 string임
            let category_id_index= find_category.indexOf(String(selected_category));
            find_category.splice(category_id_index,1);
            console.log("배열삭제 된 후"+find_category)
            $('#category').val(find_category.join(','))
            $(this).remove();
             
        })
  });
</script>